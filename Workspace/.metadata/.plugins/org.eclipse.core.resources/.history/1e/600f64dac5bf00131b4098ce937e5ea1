package model;

import java.io.*;
import java.util.*;

public class InputFileReader extends InputReader {

	private File file;
	
	public InputFileReader(String path) {
		super();
		this.file = new File(path);
	}
	
	public InputFileReader(File file) {
		super();
		this.file = file;
	}
	
	@Override
	public String getComment() throws FileNotFoundException {
		Scanner sc = new Scanner(file);
		String line;
		StringBuilder allComments = new StringBuilder();
		
		while(sc.hasNextLine())
		{
			line = sc.nextLine();
			if(line.length() > 0 && line.charAt(0) == '#') {
				// fuege zeile zu kommentar hinzu
				allComments.append(line + "\n");
			} else {
				// stoppe, da keine weiteren zeilen folgen können
				break;
			}
		}
		
		sc.close();
		
		if(allComments.length() == 0) { // ist leer?
			throw new InputMismatchException("Kein Kommentar gefunden!");
		} else {
			return allComments.toString();			
		}
	}

	@Override
	public GameState getFirstGameState()  throws FileNotFoundException {
		Scanner sc = new Scanner(file);
		String line = null;
		
		while(sc.hasNextLine())
		{
			line = sc.nextLine();
			if(line.length() > 0 && line.charAt(0) != '#') {
				// stoppe, da nun die erste zeile mit daten gefunden worden ist
				break;
			}
		}
		
		sc.close();
		
		if(line != null)
		{
			return parseGameStateFromLine(line.trim());
		} else {
			warnings.add("Bei Einlesen wurden keine Daten gefunden!");
			throw new InputMismatchException();
		}

	}

	/**
	 * Parsed die Daten für einen Spielstatus.
	 * 
	 * @param line Die Daten als String mit Leerzeichen zwischen den Integern
	 * @return Den erzeugten Spielstatus
	 * @throws InputMismatchException Falls zu viele Reihen gefunden wurden
	 * @throws NumberFormatException Falls die Werte nicht geparsed werden konnten
	 */
	private GameState parseGameStateFromLine(String line) {
		String[] parts = line.split(" ");
		List<Integer> resultList = new ArrayList<>();
		
		if(parts.length >= MINIMUM_NUMBER_OF_COLUMNS
				&& parts.length <= MAXIMUM_NUMBER_OF_COLUMNS)
		{
			for(String p : parts)
			{
				// TODO: test if valid integer
				resultList.add(Integer.parseInt(p));
			}
		}
		else {
			warnings.add("Bei Einlesen wurden zu viele Reihen gefunden!");
			throw new InputMismatchException();
		}
		
		return new GameState(resultList);
	}
}
